# Maintainer: Leonardo Held <leonardo.held@toradex.com>
pkgname=imx-gpu-viv
pkgver=6.4.11.p2.4d
pkgrel=0
arch="aarch64"
pkgdesc="Vivante GPU drivers for i.MX platforms"
url="https://www.nxp.com"
license="Proprietary"
source="https://www.nxp.com/lgfiles/sdk/lsdk2406/${pkgname}-${pkgver}-aarch64.bin"
options="!check !strip !scanelf"
makedepends="libdrm wayland-libs-client wayland-libs-cursor wayland-dev"
depends="gcompat libdrm"

build() {
    sh ${pkgname}-${pkgver}-aarch64.bin --auto-accept
}

package() {
    mkdir -p "$pkgdir/usr/lib/"
    mkdir -p "$pkgdir/etc/OpenCL/vendors/"
    mkdir -p "$pkgdir/usr/include/"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libGAL.so" "$pkgdir/usr/lib/libGAL.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libEGL.so.1.5.0" "$pkgdir/usr/lib/libEGL.so.1.5.0"
    ln -sf libEGL.so.1.5.0 "$pkgdir/usr/lib/libEGL.so.1"
    ln -sf libEGL.so.1.5.0 "$pkgdir/usr/lib/libEGL.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libGLESv2.so.2.0.0" "$pkgdir/usr/lib/libGLESv2.so.2.0.0"
    ln -sf libGLESv2.so.2.0.0 "$pkgdir/usr/lib/libGLESv2.so.2"
    ln -sf libGLESv2.so.2.0.0 "$pkgdir/usr/lib/libGLESv2.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libOpenCL.so.3.0.0" "$pkgdir/usr/lib/libOpenCL.so.3.0.0"
    ln -sf libOpenCL.so.3.0.0 "$pkgdir/usr/lib/libOpenCL.so.3"
    ln -sf libOpenCL.so.3.0.0 "$pkgdir/usr/lib/libOpenCL.so"
    ln -sf libOpenCL.so.3.0.0 "$pkgdir/usr/lib/libOpenCL.so.1"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libVDK.so.1.2.0" "$pkgdir/usr/lib/libVDK.so.1.2.0"
    ln -sf libVDK.so.1.2.0 "$pkgdir/usr/lib/libVDK.so.1"
    ln -sf libVDK.so.1.2.0 "$pkgdir/usr/lib/libVDK.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libVSC.so" "$pkgdir/usr/lib/libVSC.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libvulkan_VSI.so.1.3.3" "$pkgdir/usr/lib/libvulkan_VSI.so.1.3.3"
    ln -sf libvulkan_VSI.so.1.3.3 "$pkgdir/usr/lib/libvulkan_VSI.so.1"
    ln -sf libvulkan_VSI.so.1.3.3 "$pkgdir/usr/lib/libvulkan_VSI.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libGLSLC.so" "$pkgdir/usr/lib/libGLSLC.so"

    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libgbm_viv.so" "$pkgdir/usr/lib/libgbm_viv.so"
    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/lib/libSPIRV_viv.so" "$pkgdir/usr/lib/libSPIRV_viv.so"

    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libArchModelSw.so" "$pkgdir/usr/lib/libArchModelSw.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libCLC.so" "$pkgdir/usr/lib/libCLC.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNArchPerf.so" "$pkgdir/usr/lib/libNNArchPerf.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-evis.so" "$pkgdir/usr/lib/libNNGPUBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-evis2.so" "$pkgdir/usr/lib/libNNGPUBinary-evis2.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-lite.so" "$pkgdir/usr/lib/libNNGPUBinary-lite.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-nano.so" "$pkgdir/usr/lib/libNNGPUBinary-nano.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-ulite.so" "$pkgdir/usr/lib/libNNGPUBinary-ulite.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNVXCBinary-evis.so" "$pkgdir/usr/lib/libNNVXCBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNVXCBinary-evis2.so" "$pkgdir/usr/lib/libNNVXCBinary-evis2.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOpenVG.3d.so.1.1.0" "$pkgdir/usr/lib/libOpenVG.3d.so.1.1.0"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOpenVXU.so" "$pkgdir/usr/lib/libOpenVXU.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvx12VXCBinary-evis.so" "$pkgdir/usr/lib/libOvx12VXCBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvx12VXCBinary-evis2.so" "$pkgdir/usr/lib/libOvx12VXCBinary-evis2.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-evis.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-lite.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-lite.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-nano.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-nano.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-ulite.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-ulite.so"

    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOpenVX.so.1.3.0" "$pkgdir/usr/lib/libOpenVX.so.1.3.0"
    ln -sf libOpenVX.so.1.3.0 "$pkgdir/usr/lib/libOpenVX.so.1"
    ln -sf libOpenVX.so.1.3.0 "$pkgdir/usr/lib/libOpenVX.so"

    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libgbm.so.1.0.0" "$pkgdir/usr/lib/libgbm.so.1.0.0"
    ln -sf libgbm.so.1.0.0 "$pkgdir/usr/lib/libgbm.so.1"
    ln -sf libgbm.so.1.0.0 "$pkgdir/usr/lib/libgbm.so"

    install -Dm755 "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/etc/Vivante.icd" "$pkgdir/etc/OpenCL/vendors/Vivante.icd"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libArchModelSw.so" "$pkgdir/usr/lib/libArchModelSw.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libCLC.so" "$pkgdir/usr/lib/libCLC.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNArchPerf.so" "$pkgdir/usr/lib/libNNArchPerf.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-evis.so" "$pkgdir/usr/lib/libNNGPUBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-evis2.so" "$pkgdir/usr/lib/libNNGPUBinary-evis2.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-lite.so" "$pkgdir/usr/lib/libNNGPUBinary-lite.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-nano.so" "$pkgdir/usr/lib/libNNGPUBinary-nano.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNGPUBinary-ulite.so" "$pkgdir/usr/lib/libNNGPUBinary-ulite.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNVXCBinary-evis.so" "$pkgdir/usr/lib/libNNVXCBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libNNVXCBinary-evis2.so" "$pkgdir/usr/lib/libNNVXCBinary-evis2.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOpenVG.3d.so.1.1.0" "$pkgdir/usr/lib/libOpenVG.3d.so.1.1.0"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOpenVXU.so" "$pkgdir/usr/lib/libOpenVXU.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvx12VXCBinary-evis.so" "$pkgdir/usr/lib/libOvx12VXCBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvx12VXCBinary-evis2.so" "$pkgdir/usr/lib/libOvx12VXCBinary-evis2.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-evis.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-evis.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-lite.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-lite.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-nano.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-nano.so"
    install -Dm755 "./src/imx-gpu-viv-${pkgver}-aarch64/gpu-core/usr/lib/libOvxGPUVXCBinary-ulite.so" "$pkgdir/usr/lib/libOvxGPUVXCBinary-ulite.so"

    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/CL" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/EGL" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/GLES" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/GLES2" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/GLES3" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/HAL" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/KHR" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/VG" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/VX" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/gbm.h" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/gc_vdk.h" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/gc_vdk_types.h" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/vdk.h" "$pkgdir/usr/include/"
    cp -a "./src/imx-gpu-viv-6.4.11.p2.4d-aarch64/gpu-core/usr/include/vulkan" "$pkgdir/usr/include/"
}

sha512sums="
3cbb93796da7dc54be01da787ddd0178a4ebe84bd3eafa6acd90dc16a31d9231032d72a3bbb66d1642b0eaaf52ff9484ff6a66d9bf7012ed02d4f395e2338951  imx-gpu-viv-6.4.11.p2.4d-aarch64.bin
"

